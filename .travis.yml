# sudo: false
sudo: required
dist: trusty
language: cpp

os:
  - linux
  # - osx

# addons:
#   apt:
#     sources:
#       - ubuntu-toolchain-r-test
#     packages:
#       - gcc-4.9
#       - g++-4.9
#       - gcc-4.9-multilib
#       - g++-4.9-multilib
#       - zip
#       - libgtk2.0-0

before_install:
  - sudo ./install-apt-packages.sh
  - git submodule update --init --recursive
  - git clone https://github.com/creationix/nvm.git ./.nvm
  - source ./.nvm/nvm.sh
  - nvm install 5.10
  - nvm use 5.10
  # - |
  #   cd $HOME
  #   vnode=v5.10.1
  #   # curl -O https://nodejs.org/dist/$vnode/node-$vnode-linux-x64.tar.xz
  #   curl -O -L https://npm.taobao.org/mirrors/node/$vnode/node-$vnode-linux-x64.tar.xz
  #   tar xf node-$vnode-linux-x64.tar.xz
  #   export PATH=$PWD/node-$vnode-linux-x64/bin:$PATH
  #   cd $TRAVIS_BUILD_DIR
  # - echo "PATH=$PATH"
  - env
  - node --version
  - npm --version
  - python --version
  - npm config set python `which python`
  - npm install -g gulp
  - if [ $TRAVIS_OS_NAME == "linux" ]; then
      export CXX="g++-4.9" CC="gcc-4.9" DISPLAY=:99.0;
      sh -e /etc/init.d/xvfb start;
      sleep 3;
    fi

install:
  - ./scripts/npm.sh install

script:
  - gulp hygiene
  - gulp electron
  - gulp compile
  - ./scripts/test.sh
  - ./scripts/test-integration.sh
